classDiagram
    %% Core System Relationships
    class CanvasContext {
        +CanvasEngine engine
        +ConfigsManager configs
        +BasePlugin[] plugins
        +initialize()
    }

    class CanvasEngine {
        -ViewportManager viewport
        -CoordinateSystem coords
        -EventBus eventBus
        -CanvasNode[] nodes
        +loadGraph(nodes)
        +startDrag()
        +zoom()
        +getNodeAtPosition()
    }

    class ConfigsManager {
        +ViewportConfig
        +ThemeConfig
        +UIConfig
        +subscribe(key, callback)
    }

    class EventBus {
        +on(event, callback)
        +emit(event, data)
    }

    class ViewportManager {
        +x, y, zoom
        +setViewport()
        +screenToWorld()
    }

    %% Relationships
    CanvasContext *-- CanvasEngine
    CanvasContext *-- ConfigsManager
    CanvasEngine *-- ViewportManager
    CanvasEngine *-- EventBus
    ViewportManager ..> EventBus : Emits changes

    %% Plugin System
    class BasePlugin {
        <<Abstract>>
        +initialize(engine)
        +activate()
        +render()
    }

    class NodeLayerPlugin {
        +render() NodeLayer Component
    }
    class GridPlugin {
        +render() Grid Component
    }
    class MinimapPlugin {
        +render() Minimap Component
    }
    class ToolbarPlugin {
        +render() Toolbar Component
    }

    BasePlugin <|-- NodeLayerPlugin
    BasePlugin <|-- GridPlugin
    BasePlugin <|-- MinimapPlugin
    BasePlugin <|-- ToolbarPlugin
    
    CanvasContext o-- BasePlugin : Manages

    %% Interaction Flow
    class ReactComponents {
        CanvasContainer
        App
    }

    ReactComponents ..> CanvasEngine : User Inputs (Pointer/Wheel)
    NodeLayerPlugin ..> EventBus : Listens node-dragged
    GridPlugin ..> EventBus : Listens viewport-changed
    MinimapPlugin ..> CanvasEngine : Calls setViewport

    %% Styling
    classDef core fill:#E8F4FF,stroke:#2C77F4,stroke-width:2px,color:#0b1f3a
    classDef config fill:#E8FFE8,stroke:#2CA02C,stroke-width:2px,color:#09320b
    classDef event fill:#FFF9E6,stroke:#D4A017,stroke-width:2px,color:#4a3300
    classDef viewport fill:#FFF2E8,stroke:#FF7F0E,stroke-width:2px,color:#3a1f00
    classDef plugin fill:#F5E8FF,stroke:#8E44AD,stroke-width:2px,color:#2f0f3a
    classDef react fill:#F6F6F6,stroke:#999999,stroke-width:1.5px,color:#222222
    
    %% FIX: Removed 'stroke-dasharray' which was causing the parser error
    classDef abstract fill:#FFFFFF,stroke:#666666,color:#222222

    %% Assignments
    class CanvasContext,CanvasEngine core
    class ConfigsManager config
    class EventBus event
    class ViewportManager viewport
    class BasePlugin abstract
    class NodeLayerPlugin,GridPlugin,MinimapPlugin,ToolbarPlugin plugin
    class ReactComponents react
